{{define "content"}}
<div class="bg-white p-6 rounded-lg shadow-md">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">Orden #{{.Order.ID}} - Mesa {{.Order.Table.Number}}</h1>
        <div class="space-x-2">
            <form class="inline" action="/order/complete/{{.Order.ID}}" method="POST">
                <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md">
                    Completar Orden
                </button>
            </form>

            <form class="inline" action="/order/cancel/{{.Order.ID}}" method="POST">
                <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md">
                    Cancelar Orden
                </button>
            </form>
        </div>
    </div>

    <div class="flex flex-col md:flex-row gap-6">
        <!-- Panel izquierdo: Items de la orden -->
        <div class="md:w-1/2">
            <h2 class="text-xl font-semibold mb-4">Items en la orden</h2>

            {{if eq (len .Order.Items) 0}}
            <p class="text-gray-500 italic">No hay items en la orden</p>
            {{else}}
            <div class="space-y-4">
                {{range .Order.Items}}
                <div class="border rounded-lg p-4 bg-gray-50">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-medium">{{.MenuItem.Name}}</h3>
                            <p class="text-gray-600 text-sm">{{.MenuItem.Description}}</p>
                            {{if .Notes}}
                            <p class="text-sm italic mt-1">Notas: {{.Notes}}</p>
                            {{end}}
                        </div>
                        <div class="text-right">
                            <p class="font-bold">${{.MenuItem.Price}} × {{.Quantity}}</p>
                            <form action="/order/item/{{.ID}}" method="POST" class="mt-2 flex items-center justify-end">
                                <button type="submit" name="quantity" value="{{sub .Quantity 1}}"
                                    class="bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded-l-md">
                                    -
                                </button>
                                <span class="px-3 py-1 bg-white">{{.Quantity}}</span>
                                <button type="submit" name="quantity" value="{{add .Quantity 1}}"
                                    class="bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded-r-md">
                                    +
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {{end}}
            </div>

            <div class="mt-6 border-t pt-4">
                <div class="flex justify-between items-center text-xl font-bold">
                    <span>Total:</span>
                    <span>${{.Order.Total}}</span>
                </div>
            </div>
            {{end}}
        </div>

        <!-- Panel derecho: Añadir items -->
        <div class="md:w-1/2">
            <h2 class="text-xl font-semibold mb-4">Añadir a la orden</h2>

            <div class="mb-4">
                <input type="text" id="menuSearch" placeholder="Buscar en el menú..."
                    class="w-full p-2 border rounded-md" oninput="filterMenu(this.value)">
            </div>

            <div class="space-y-6" id="menuCategories">
                {{range $category, $items := .Categories}}
                <div class="menu-category">
                    <h3 class="text-lg font-semibold mb-2 border-b pb-2">{{$category}}</h3>

                    <div class="space-y-2">
                        {{range $items}}
                        <div class="menu-item border rounded-lg p-3 hover:bg-gray-50 transition-colors">
                            <form action="/order/add-item" method="POST">
                                <input type="hidden" name="order_id" value="{{$.Order.ID}}">
                                <input type="hidden" name="menu_item_id" value="{{.ID}}">

                                <div class="flex justify-between mb-2">
                                    <div>
                                        <h4 class="font-medium menu-item-name">{{.Name}}</h4>
                                        <p class="text-gray-600 text-sm">{{.Description}}</p>
                                    </div>
                                    <p class="font-bold">${{.Price}}</p>
                                </div>

                                <div class="flex space-x-2">
                                    <input type="number" name="quantity" value="1" min="1"
                                        class="w-16 p-1 border rounded-md">

                                    <input type="text" name="notes" placeholder="Notas para cocina"
                                        class="flex-grow p-1 border rounded-md">

                                    <button type="submit"
                                        class="bg-blue-500 hover:bg-blue-600 text-white px-3 rounded-md">
                                        Añadir
                                    </button>
                                </div>
                            </form>
                        </div>
                        {{end}}
                    </div>
                </div>
                {{end}}
            </div>
        </div>
    </div>
</div>

<script>
    function filterMenu(query) {
        query = query.toLowerCase();
        const categories = document.querySelectorAll('.menu-category');

        categories.forEach(category => {
            const items = category.querySelectorAll('.menu-item');
            let visibleItems = 0;

            items.forEach(item => {
                const name = item.querySelector('.menu-item-name').textContent.toLowerCase();
                if (name.includes(query)) {
                    item.style.display = 'block';
                    visibleItems++;
                } else {
                    item.style.display = 'none';
                }
            });

            // Ocultar categoría si no tiene items visibles
            category.style.display = visibleItems > 0 ? 'block' : 'none';
        });
    }
</script>
{{end}}